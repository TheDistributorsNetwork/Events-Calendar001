<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Members Area</title>
<style>
body{font-family:Arial;margin:0;padding:40px;background:#002147;color:#fff;text-align:center;}
.container{max-width:1100px;margin:auto;background:#1a1a1a;padding:30px;border-radius:12px;text-align:left;}
h1,h2,h3{color:#FFD700;}
.btn{background:#FFD700;color:#000;border:none;padding:8px 14px;border-radius:6px;cursor:pointer;margin:4px;}
.btn-danger{background:#800000;color:#fff;}
input,select{width:100%;padding:8px;margin:6px 0;border:none;border-radius:4px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{border:1px solid #333;padding:8px;}
th{background:#800000;color:#FFD700;}
</style>
</head>
<body>
<div class="container">

<h1>Members Area</h1>

<div id="loginStage">
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<button class="btn" onclick="login()">Login</button>
<a href="index.html" class="btn">Back to Calendar</a>
</div>

<div id="membersStage" style="display:none;">
<button class="btn" onclick="logout()">Logout</button>
<a href="index.html" class="btn">Back to Calendar</a>

<h3>Add / Edit User</h3>
<input id="editUsername" placeholder="Username">
<input id="editPassword" placeholder="Password">
<select id="editRole">
<option value="member">Member</option>
<option value="admin">Admin</option>
</select>
<label><input type="checkbox" id="editRequest"> Can Request Event</label>
<button class="btn" onclick="saveUser()">Save User</button>

<div id="userList"></div>

<h3>Pending Event Requests</h3>
<table id="pendingTable">
<tr><th>User</th><th>Date</th><th>Event</th><th>Host</th><th>Actions</th></tr>
</table>

</div>
</div>

<script>
if(!localStorage.getItem("users")){
localStorage.setItem("users",JSON.stringify({
admin1:{password:"admin123",role:"admin",active:true,canRequestEvent:true}
}));
}

let users=JSON.parse(localStorage.getItem("users"));
let requests=JSON.parse(localStorage.getItem("requests")||"[]");
let events=JSON.parse(localStorage.getItem("events")||"[]");
let editingUser=null;

function login(){
if(users[username.value]&&users[username.value].password===password.value){
loginStage.style.display="none";
membersStage.style.display="block";
loadUsers();
renderRequests();
}else alert("Invalid login.");
}

function logout(){
membersStage.style.display="none";
loginStage.style.display="block";
}

function loadUsers(){
let html="";
Object.keys(users).forEach(u=>{
html+=`<div>
<strong>${u}</strong> (${users[u].role})
<button class="btn" onclick="editUser('${u}')">Edit</button>
${u!=="admin1"?`<button class="btn btn-danger" onclick="deleteUser('${u}')">Delete</button>`:""}
</div>`;
});
userList.innerHTML=html;
}

function editUser(u){
if(u==="admin1") return;
editingUser=u;
editUsername.value=u;
editPassword.value=users[u].password;
editRole.value=users[u].role;
editRequest.checked=users[u].canRequestEvent||false;
}

function saveUser(){
const uname=editUsername.value;
if(uname==="admin1") return;
users[uname]={
password:editPassword.value,
role:editRole.value,
active:true,
canRequestEvent:editRequest.checked
};
localStorage.setItem("users",JSON.stringify(users));
editUsername.value="";editPassword.value="";editRequest.checked=false;
loadUsers();
}

function deleteUser(u){
if(u==="admin1") return;
delete users[u];
localStorage.setItem("users",JSON.stringify(users));
loadUsers();
}

function renderRequests(){
pendingTable.innerHTML=`<tr><th>User</th><th>Date</th><th>Event</th><th>Host</th><th>Actions</th></tr>`;
requests.forEach((r,i)=>{
pendingTable.innerHTML+=`<tr>
<td>${r.username}</td>
<td><input value="${r.date}" onchange="requests[${i}].date=this.value"></td>
<td><input value="${r.event}" onchange="requests[${i}].event=this.value"></td>
<td><input value="${r.host}" onchange="requests[${i}].host=this.value"></td>
<td>
<button class="btn" onclick="approve(${i})">Approve</button>
<button class="btn btn-danger" onclick="decline(${i})">Decline</button>
</td>
</tr>`;
});
}

function approve(i){
events.push(requests[i]);
requests.splice(i,1);
localStorage.setItem("events",JSON.stringify(events));
localStorage.setItem("requests",JSON.stringify(requests));
renderRequests();
}

function decline(i){
requests.splice(i,1);
localStorage.setItem("requests",JSON.stringify(requests));
renderRequests();
}
</script>
</body>
</html>
