<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Members Administration</title>
<style>
body{font-family:Arial;margin:0;padding:40px;background:#002147;color:#fff;text-align:center;}
.container{max-width:1100px;margin:auto;background:#1a1a1a;padding:30px;border-radius:12px;text-align:left;}
h1,h3{color:#FFD700;}
.btn{background:#FFD700;color:#000;padding:8px 14px;border-radius:6px;border:none;margin:4px;cursor:pointer;font-weight:bold;}
.btn-danger{background:#800000;color:#fff;}
input,select{width:100%;padding:8px;margin:6px 0;border-radius:4px;border:none;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #333;padding:8px;}
th{background:#800000;color:#FFD700;}
</style>
</head>
<body>

<div class="container">

<h1>Members Administration</h1>

<div id="loginStage">
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<button class="btn" onclick="login()">Login</button>
<a href="index.html" class="btn">Back to Calendar</a>
</div>

<div id="adminPanel" style="display:none;">

<button class="btn" onclick="logout()">Logout</button>
<a href="index.html" class="btn">Back to Calendar</a>

<h3>Add / Edit User</h3>
<input id="uName" placeholder="Username">
<input id="uPass" placeholder="Password">
<select id="uRole">
<option value="member">Member</option>
<option value="admin">Admin</option>
</select>
<label><input type="checkbox" id="uRequest"> Can Request Event</label>
<button class="btn" onclick="saveUser()">Save User</button>

<h3>Existing Users</h3>
<div id="userList"></div>

<h3>Pending Event Requests</h3>
<table id="pendingTable">
<tr><th>User</th><th>Date</th><th>Event</th><th>Host</th><th>Actions</th></tr>
</table>

</div>
</div>

<script>
let users=JSON.parse(localStorage.getItem("users"));
let requests=JSON.parse(localStorage.getItem("requests")||"[]");
let events=JSON.parse(localStorage.getItem("events")||"[]");
let editingUser=null;

function login(){
if(users[username.value]&&users[username.value].password===password.value&&users[username.value].role==="admin"){
loginStage.style.display="none";
adminPanel.style.display="block";
loadUsers();
renderRequests();
}else alert("Admin access only.");
}

function logout(){
adminPanel.style.display="none";
loginStage.style.display="block";
}

function loadUsers(){
let html="";
Object.keys(users).forEach(u=>{
html+=`<div>
<strong>${u}</strong> (${users[u].role})
<button class="btn" onclick="editUser('${u}')">Edit</button>
${u!=="admin1"?`<button class="btn btn-danger" onclick="deleteUser('${u}')">Delete</button>`:""}
</div>`;
});
userList.innerHTML=html;
}

function editUser(u){
if(u==="admin1") return;
editingUser=u;
uName.value=u;
uPass.value=users[u].password;
uRole.value=users[u].role;
uRequest.checked=users[u].canRequestEvent||false;
}

function saveUser(){
if(uName.value==="admin1") return;
users[uName.value]={
password:uPass.value,
role:uRole.value,
active:true,
canRequestEvent:uRequest.checked
};
localStorage.setItem("users",JSON.stringify(users));
uName.value="";uPass.value="";uRequest.checked=false;
loadUsers();
}

function deleteUser(u){
if(u==="admin1") return;
delete users[u];
localStorage.setItem("users",JSON.stringify(users));
loadUsers();
}

function renderRequests(){
pendingTable.innerHTML=`<tr><th>User</th><th>Date</th><th>Event</th><th>Host</th><th>Actions</th></tr>`;
requests.forEach((r,i)=>{
pendingTable.innerHTML+=`<tr>
<td>${r.username}</td>
<td><input value="${r.date}" onchange="requests[${i}].date=this.value"></td>
<td><input value="${r.event}" onchange="requests[${i}].event=this.value"></td>
<td><input value="${r.host}" onchange="requests[${i}].host=this.value"></td>
<td>
<button class="btn" onclick="approve(${i})">Approve</button>
<button class="btn btn-danger" onclick="decline(${i})">Decline</button>
</td>
</tr>`;
});
}

function approve(i){
events.push({...requests[i],addedBy:requests[i].username});
requests.splice(i,1);
localStorage.setItem("events",JSON.stringify(events));
localStorage.setItem("requests",JSON.stringify(requests));
renderRequests();
}

function decline(i){
requests.splice(i,1);
localStorage.setItem("requests",JSON.stringify(requests));
renderRequests();
}
</script>

</body>
</html>
