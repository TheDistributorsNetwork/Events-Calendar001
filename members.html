<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Events Calendar</title>

<style>
/* --- YOUR ORIGINAL STYLING KEPT --- */
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 40px;
  background-color: #002147;
  color: #fff;
}
header {
  text-align: center;
  margin-bottom: 30px;
  position: relative;
}
.version {
  font-size: 0.8em;
  color: #aaa;
  font-style: italic;
  margin-bottom: 8px;
  display: block;
}
header img.logo-left {
  width: 120px;
  position: absolute;
  left: 0;
  top: 25px;
}
header img.logo-right {
  width: 120px;
  position: absolute;
  right: 0;
  top: 25px;
}
header img.logo-center {
  width: 160px;
  display: block;
  margin: 25px auto 15px auto;
}
header h1 {
  color: #FFD700;
  font-size: 2em;
  margin: 0;
}
header h2 {
  color: #FFD700;
  font-size: 1em;
  margin: 0;
}
table {
  width: 90%;
  margin: 0 auto;
  border-collapse: collapse;
  background-color: #1a1a1a;
  box-shadow: 0 4px 12px rgba(0,0,0,0.6);
}
th, td {
  border: 1px solid #333;
  padding: 14px;
  text-align: left;
}
th {
  background-color: #800000;
  color: #FFD700;
  text-transform: uppercase;
}
tr:nth-child(even){background-color:#262626;}
tr:nth-child(odd){background-color:#1a1a1a;}

.btn {
  display: inline-block;
  background-color: #FFD700;
  color: #000;
  font-weight: bold;
  padding: 12px 24px;
  border-radius: 6px;
  margin: 5px;
  cursor: pointer;
  border: none;
}
.btn-danger{background:#800000;color:#fff;}

.form-box{
  display:none;
  background:#1a1a1a;
  padding:20px;
  max-width:600px;
  margin:20px auto;
  border-radius:10px;
}
.form-box input{
  width:100%;
  padding:8px;
  margin:6px 0;
}

.envelope{
  text-align:center;
  font-size:40px;
  margin-top:15px;
  cursor:pointer;
  display:none;
}
.pending-box{
  display:none;
  max-width:800px;
  margin:10px auto;
}
</style>
</head>

<body>

<header>
  <span class="version">Version 2.0PRI</span>
  <img src="logo-left.png" class="logo-left">
  <img src="logo-right.png" class="logo-right">
  <img src="logo.png" class="logo-center">
  <h1>Message Believer's Network Calendar</h1>
  <h2>By The Distributor</h2>
</header>

<div style="text-align:center;">
  <button class="btn" onclick="openForm()">Request Event</button>
  <a href="members.html" class="btn">Members</a>
</div>

<!-- EVENT FORM -->
<div class="form-box" id="eventForm">
<h3>Event Request</h3>
<input type="date" id="evDate">
<input type="text" id="evTitle" placeholder="Event Title">
<input type="text" id="evDetails" placeholder="Details">
<input type="text" id="evHost" placeholder="Host Church / Pastor">
<input type="file" id="evImage" accept="image/*">
<button class="btn" onclick="submitEvent()">Submit</button>
<button class="btn btn-danger" onclick="closeForm()">Cancel</button>
</div>

<div class="envelope" id="envelope" onclick="togglePending()">ðŸ“©</div>
<div class="pending-box" id="pendingBox"></div>

<table>
<thead>
<tr>
<th>Date</th>
<th>Event</th>
<th>Details</th>
<th>Host Church</th>
<th>Invitation</th>
</tr>
</thead>
<tbody id="calendarBody"></tbody>
</table>

<script>

/* SESSION */
const currentUser = localStorage.getItem("currentUser");
const currentRole = localStorage.getItem("currentRole");

/* STORAGE */
function getApproved(){return JSON.parse(localStorage.getItem("approvedEvents")||"[]");}
function getPending(){return JSON.parse(localStorage.getItem("pendingEvents")||"[]");}
function saveApproved(d){localStorage.setItem("approvedEvents",JSON.stringify(d));}
function savePending(d){localStorage.setItem("pendingEvents",JSON.stringify(d));}

/* ADMIN ENVELOPE */
if(currentRole==="admin"){
  document.getElementById("envelope").style.display="block";
  loadPending();
}

/* FORM CONTROL */
function openForm(){
  if(!currentUser){
    alert("You must login in Members section first.");
    return;
  }
  eventForm.style.display="block";
}
function closeForm(){eventForm.style.display="none";}

/* SUBMIT */
function submitEvent(){
  if(!evDate.value||!evTitle.value){alert("Date and Title required");return;}

  const ev={
    id:Date.now(),
    date:evDate.value,
    title:evTitle.value,
    details:evDetails.value,
    host:evHost.value,
    submittedBy:currentUser,
    image:null
  };

  if(evImage.files[0]){
    const reader=new FileReader();
    reader.onload=function(){
      ev.image=reader.result;
      savePendingEvent(ev);
    };
    reader.readAsDataURL(evImage.files[0]);
  } else {
    savePendingEvent(ev);
  }
}

function savePendingEvent(ev){
  const list=getPending();
  list.push(ev);
  savePending(list);
  alert("Submitted for admin approval.");
  closeForm();
}

/* PENDING */
function loadPending(){
  if(currentRole!=="admin") return;

  const list=getPending();
  let html="";
  list.forEach(ev=>{
    html+=`
    <div style="background:#1a1a1a;padding:10px;margin:10px;border-radius:6px;">
      <strong>${ev.date}</strong> - ${ev.title}<br>
      ${ev.details}<br>
      ${ev.host}<br>
      Submitted by: ${ev.submittedBy}<br>
      <button class="btn" onclick="approve(${ev.id})">Approve</button>
      <button class="btn btn-danger" onclick="reject(${ev.id})">Reject</button>
    </div>`;
  });
  pendingBox.innerHTML=html;
}

function togglePending(){
  pendingBox.style.display=
  pendingBox.style.display==="block"?"none":"block";
}

function approve(id){
  let pending=getPending();
  const approved=getApproved();
  const ev=pending.find(e=>e.id===id);
  approved.push(ev);
  pending=pending.filter(e=>e.id!==id);
  saveApproved(approved);
  savePending(pending);
  loadCalendar();
  loadPending();
}

function reject(id){
  let pending=getPending().filter(e=>e.id!==id);
  savePending(pending);
  loadPending();
}

/* LOAD LIVE */
function loadCalendar(){
  const events=getApproved();
  calendarBody.innerHTML="";
  events.forEach(ev=>{
    calendarBody.innerHTML+=`
    <tr>
      <td>${ev.date}</td>
      <td>${ev.title}</td>
      <td>${ev.details}</td>
      <td>${ev.host}</td>
      <td>${ev.image?`<a href="${ev.image}" target="_blank">View Invite</a>`:"-"}</td>
    </tr>`;
  });
}
loadCalendar();

</script>
</body>
</html>
