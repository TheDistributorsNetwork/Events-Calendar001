<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Members Area</title>
<style>
body{font-family:Arial;margin:0;padding:40px;background:#002147;color:#fff;}
h1,h2,h3{color:#FFD700;}
.container{max-width:1100px;margin:auto;background:#1a1a1a;padding:30px;border-radius:12px;}
.btn{background:#FFD700;color:#000;border:none;padding:8px 14px;border-radius:6px;cursor:pointer;font-weight:bold;margin:4px 2px;}
.btn-danger{background:#800000;color:#fff;}
input,select{width:100%;padding:8px;margin:6px 0;}
</style>
</head>

<body>
<div class="container">

<h1>Members Area</h1>

<div id="loginStage">
<h2>Login</h2>
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<button class="btn" onclick="login()">Login</button>
</div>

<div id="membersStage" style="display:none;">
<button class="btn" onclick="logout()">Logout</button>

<!-- EVENT REQUEST FORM (Pastors + Admins) -->
<h3>Create Event Request</h3>
<input id="eDate" placeholder="Date (e.g. 23 Nov 2025)">
<input id="eTitle" placeholder="Event Title">
<input id="eDetails" placeholder="Details">
<input id="eHost" placeholder="Host Church">
<input id="eInvite" placeholder="Invitation Link">
<button class="btn" onclick="submitEvent()">Submit Request</button>

<hr>

<!-- ADMIN APPROVAL SECTION -->
<div id="adminApproval" style="display:none;">
<h3>Pending Event Requests</h3>
<div id="pendingList"></div>
<hr>
</div>

</div>
</div>

<script>

/* STORAGE */
function getUsers(){return JSON.parse(localStorage.getItem("users")||"{}");}
function saveUsers(u){localStorage.setItem("users",JSON.stringify(u));}
function getPending(){return JSON.parse(localStorage.getItem("pendingEvents")||"[]");}
function savePending(p){localStorage.setItem("pendingEvents",JSON.stringify(p));}
function getApproved(){return JSON.parse(localStorage.getItem("approvedEvents")||"[]");}
function saveApproved(a){localStorage.setItem("approvedEvents",JSON.stringify(a));}

/* INIT */
if(!localStorage.getItem("users")){
  saveUsers({
    admin1:{password:"admin123",role:"admin",active:true},
    pastor1:{password:"pastor123",role:"pastor",active:true}
  });
}

let role=null;

/* LOGIN */
function login(){
  const users=getUsers();
  const user=users[username.value];
  if(user && user.password===password.value && user.active){
    role=user.role;
    loginStage.style.display="none";
    membersStage.style.display="block";
    if(role==="admin"){
      adminApproval.style.display="block";
      loadPending();
    }
  } else {
    alert("Invalid login");
  }
}

function logout(){
  role=null;
  membersStage.style.display="none";
  loginStage.style.display="block";
}

/* PASTOR SUBMIT EVENT */
function submitEvent(){
  const event={
    id:Date.now(),
    date:eDate.value,
    title:eTitle.value,
    details:eDetails.value,
    host:eHost.value,
    invite:eInvite.value
  };

  const pending=getPending();
  pending.push(event);
  savePending(pending);

  eDate.value="";
  eTitle.value="";
  eDetails.value="";
  eHost.value="";
  eInvite.value="";

  alert("Event request submitted for admin approval.");
}

/* ADMIN APPROVAL */
function loadPending(){
  const pending=getPending();
  let html="";
  pending.forEach(e=>{
    html+=`
      <div style="background:#262626;padding:10px;margin:10px 0;">
        <strong>${e.date} - ${e.title}</strong><br>
        ${e.details}<br>
        ${e.host}<br>
        <button class="btn" onclick="approveEvent(${e.id})">Approve</button>
        <button class="btn btn-danger" onclick="rejectEvent(${e.id})">Reject</button>
      </div>
    `;
  });
  pendingList.innerHTML=html || "<p>No pending requests.</p>";
}

function approveEvent(id){
  const pending=getPending();
  const approved=getApproved();
  const event=pending.find(e=>e.id===id);

  approved.push(event);
  saveApproved(approved);

  savePending(pending.filter(e=>e.id!==id));
  loadPending();
}

function rejectEvent(id){
  const pending=getPending().filter(e=>e.id!==id);
  savePending(pending);
  loadPending();
}

</script>
</body>
</html>
